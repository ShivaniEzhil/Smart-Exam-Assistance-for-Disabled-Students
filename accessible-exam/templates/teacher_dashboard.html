<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teacher Dashboard â€” Accessible Exam Tool</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

  <a href="#main-content" class="skip-link">Skip to main content</a>

  <main id="main-content" class="container container-wide td-main" role="main">

    <!-- Top bar -->
    <div class="dash-topbar td-topbar">
      <div class="td-topbar-left">
        <div class="td-avatar">
          <svg viewBox="0 0 24 24" fill="currentColor" width="28" height="28"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9-4.03-9-9-9zm0 2.4c1.49 0 2.7 1.21 2.7 2.7S13.49 10.8 12 10.8 9.3 9.59 9.3 8.1 10.51 5.4 12 5.4zm0 12.76c-2.25 0-4.24-1.15-5.4-2.89.03-1.79 3.6-2.76 5.4-2.76s5.37.98 5.4 2.76c-1.16 1.74-3.15 2.89-5.4 2.89z"/></svg>
        </div>
        <div>
          <h1>Teacher Dashboard</h1>
          <p class="subtitle">Welcome, <strong>{{ session.name }}</strong></p>
        </div>
      </div>
      <div class="dash-topbar-actions">
        <a href="{{ url_for('logout') }}" class="btn td-btn-logout">
          <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/></svg>
          Logout
        </a>
      </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="{% if category == 'error' %}error-box{% else %}success-box{% endif %}" role="alert">
      {{ message }}
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <!-- ========== UPLOAD SECTION ========== -->
    <section class="dash-section td-upload-section" role="region" aria-label="Upload question paper">
      <h2>
        <svg viewBox="0 0 24 24" fill="currentColor" width="22" height="22" style="vertical-align:-4px;margin-right:6px;opacity:0.7"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/></svg>
        Upload Question Paper
      </h2>

      <form method="POST" action="{{ url_for('teacher_upload') }}" enctype="multipart/form-data" class="upload-inline td-upload-form" id="uploadForm">

        <div class="upload-inline-row">
          <div class="form-group upload-inline-field">
            <label for="subject" class="form-label">Subject / Exam Name</label>
            <input type="text" id="subject" name="subject" class="form-input td-input"
              required placeholder="e.g. Mathematics, Science, English">
          </div>

          <div class="form-group upload-inline-field">
            <label for="exam-mode" class="form-label">Assign To</label>
            <select id="exam-mode" name="exam_mode" class="form-input form-select td-input" required>
              <option value="" disabled selected>-- Select --</option>
              <option value="voice">Blind Students (Voice Exam)</option>
              <option value="visual">Deaf &amp; Mute Students (Visual Exam)</option>
              <option value="both">Both Groups</option>
            </select>
          </div>
        </div>

        <div class="upload-inline-row">
          <div class="form-group upload-inline-field">
            <label for="fileInput" class="form-label">Question Paper File</label>
            <input type="file" name="question_paper" id="fileInput"
              accept=".pdf,image/*" required class="file-input-accessible td-file-input"
              aria-describedby="file-help">
            <p id="file-help" class="file-help">
              PDF, PNG, JPG, JPEG, WebP, BMP, TIFF, GIF (max 10 MB)
            </p>
          </div>

          <div class="form-group upload-inline-field upload-inline-btn-wrap">
            <button type="submit" class="btn td-btn-upload" id="startBtn" disabled>
              <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20"><path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/></svg>
              Upload Paper
            </button>
          </div>
        </div>

      </form>
    </section>

    <!-- ========== PAPERS LIST ========== -->
    <section class="dash-section td-papers-section" role="region" aria-label="Uploaded question papers">
      <h2>
        <svg viewBox="0 0 24 24" fill="currentColor" width="22" height="22" style="vertical-align:-4px;margin-right:6px;opacity:0.7"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
        Your Uploaded Papers
      </h2>

      {% if papers | length == 0 %}
      <div class="empty-state td-empty">
        <svg viewBox="0 0 24 24" fill="currentColor" width="48" height="48" style="opacity:0.25;margin-bottom:12px"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h7v5h5v11z"/></svg>
        <p>No papers uploaded yet.<br>Use the form above to upload your first paper.</p>
      </div>
      {% else %}

      <div class="paper-grid">
        {% for paper in papers %}
        <div class="paper-card td-paper-card">
          <div class="td-paper-accent td-paper-accent-{{ paper.exam_mode }}"></div>
          <div class="paper-card-header">
            <h3 class="paper-subject">{{ paper.subject }}</h3>
            <span class="paper-badge td-badge">{{ paper.num_questions }} Q</span>
          </div>
          <div class="paper-card-body">
            <p class="paper-meta">
              <span>
                <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14" style="vertical-align:-2px;margin-right:4px;opacity:0.5"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm4 18H6V4h8l6 6v10z"/></svg>
                {{ paper.filename }}
              </span>
              <span>
                <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14" style="vertical-align:-2px;margin-right:4px;opacity:0.5"><path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/><path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
                {{ paper.uploaded_at }}
              </span>
            </p>
            <span class="mode-tag mode-tag-{{ paper.exam_mode }}">
              {% if paper.exam_mode == 'voice' %}Blind Students
              {% elif paper.exam_mode == 'visual' %}Deaf &amp; Mute Students
              {% else %}All Students{% endif %}
            </span>
          </div>
          <div class="paper-card-footer">
            <form method="POST" action="{{ url_for('delete_paper', paper_id=paper.paper_id) }}"
              onsubmit="return confirm('Delete this paper? Students will no longer see it.')">
              <button type="submit" class="btn td-btn-delete">
                <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/></svg>
                Delete
              </button>
            </form>
          </div>
        </div>
        {% endfor %}
      </div>

      {% endif %}
    </section>

  </main>

  <script>
    var fileInput = document.getElementById('fileInput');
    var startBtn  = document.getElementById('startBtn');

    if (fileInput) {
      fileInput.addEventListener('change', function () {
        startBtn.disabled = fileInput.files.length === 0;
      });
    }
  </script>

</body>
</html>
